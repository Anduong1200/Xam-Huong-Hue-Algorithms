<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XƒÉm H∆∞·ªùng Research Platform - Royal Edition</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="royal-theme">
    <div class="glass-container">
        <header class="app-header">
            <div class="header-content">
                <div class="brand">
                    <span class="symbol">‚öúÔ∏è</span>
                    <h1>XƒÉm H∆∞·ªùng Research</h1>
                </div>
                <div class="economy-hud">
                    <div class="hud-item user-profile">
                        <label>Player</label>
                        <span id="player-name-display" class="hud-val">Royal Player</span>
                    </div>
                    <div class="hud-item">
                        <label>Balance:</label>
                        <span id="balance-display" class="hud-val">1,000</span>
                    </div>
                    <div class="hud-item">
                        <label>Jackpot:</label>
                        <span id="jackpot-display" class="hud-val jackpot">5,000</span>
                    </div>
                    <div class="hud-item bet-input-group">
                        <label>Bet:</label>
                        <input type="number" id="bet-input" value="10" min="1" step="10">
                    </div>
                </div>
                <div class="version-tag">Royal Edition v3.5</div>
            </div>

            <nav class="main-tabs">
                <button class="tab-btn active" data-tab="play">üéÆ Play</button>
                <button class="tab-btn" data-tab="sandbox">üß™ Sandbox</button>
                <button class="tab-btn" data-tab="analysis">üìä Analytics</button>
                <button class="tab-btn" data-tab="heritage">üìú Heritage</button>
                <button class="tab-btn" data-tab="config">‚öôÔ∏è Engine</button>
            </nav>
        </header>

        <main class="content-view">
            <!-- PLAY VIEW -->
            <section id="tab-play" class="tab-content active">
                <div class="game-dashboard">
                    <div class="bowl-area">
                        <div id="bowl" class="royal-bowl">
                            <div class="placeholder">Th·∫£ h·ªôt...</div>
                        </div>
                        <div class="bowl-shadow"></div>
                    </div>

                    <div class="game-controls">
                        <button id="btn-roll" class="btn-royal">Roll Dice</button>
                        <div class="result-card">
                            <div id="result-text" class="result-title">---</div>
                            <div id="payout-display" class="payout-badge">0x</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SANDBOX VIEW -->
            <section id="tab-sandbox" class="tab-content">
                <div class="sandbox-header">
                    <h2>Dice Sandbox</h2>
                    <p>Directly manipulate dice state to test rule classification.</p>
                </div>
                <div id="sandbox-board" class="sandbox-grid">
                    <!-- Dynamic Dice -->
                </div>
                <div class="sandbox-info">
                    <div class="info-item">
                        <label>Classification:</label>
                        <span id="sandbox-outcome" class="highlight">None</span>
                    </div>
                    <div class="info-item">
                        <label>Royal Score:</label>
                        <span id="sandbox-score" class="highlight">0</span>
                    </div>
                </div>
            </section>

            <!-- ANALYSIS VIEW -->
            <section id="tab-analysis" class="tab-content">
                <div class="analysis-grid">
                    <div class="panel chart-panel">
                        <h3>Probability Distribution</h3>
                        <canvas id="dist-chart"></canvas>
                    </div>
                    <div class="panel stats-panel">
                        <h3>Engine Metrics</h3>
                        <div id="engine-metrics" class="metrics-list"></div>
                    </div>
                </div>

                <!-- Advanced Analytics Row -->
                <div class="analysis-grid three-col">
                    <div class="panel heatmap-panel">
                        <h3>Face Frequency Heatmap (Last 10k)</h3>
                        <div id="heatmap-grid" class="heatmap-grid"></div>
                    </div>

                    <div class="panel equity-panel">
                        <h3>Equity Curve</h3>
                        <canvas id="equity-chart"></canvas>
                    </div>

                    <div class="panel risk-panel">
                        <h3>Risk of Ruin Calculator</h3>
                        <div id="risk-form" class="risk-form">
                            <label>Balance</label>
                            <input type="number" id="rr-balance" value="1000">
                            <label>Bet Size</label>
                            <input type="number" id="rr-bet" value="50">
                            <label>Target Profit</label>
                            <input type="number" id="rr-target" value="1000">
                            <button id="btn-calc-risk" class="btn-secondary">Calculate Risk</button>
                            <div id="risk-result" class="result-display">--</div>
                        </div>
                    </div>
                </div>

                <div class="panel heatmap-panel full-width">
                    <h3>Conditional Probability Matrix</h3>
                    <div class="cond-tools">
                        <span>Given first 2 dice: </span>
                        <span id="cond-prob-setup" class="dice-set"></span>
                        <button id="btn-calc-cond" class="btn-secondary">Re-calculate</button>
                    </div>
                    <div id="cond-prob-output" class="prob-results"></div>
                </div>
                <!-- Session Insights -->
                <div class="analysis-grid">
                    <div class="panel stats-card">
                        <h3>Session Streaks</h3>
                        <div id="session-streaks" class="streaks-display">
                            <div class="streak-item">
                                <label>Current</label>
                                <span id="strk-current" class="val neutral">0</span>
                            </div>
                            <div class="streak-item">
                                <label>Best Win</label>
                                <span id="strk-max-win" class="val win">0</span>
                            </div>
                            <div class="streak-item">
                                <label>Worst Loss</label>
                                <span id="strk-max-loss" class="val loss">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="panel logs-panel">
                        <h3>Live Transaction Log</h3>
                        <div id="session-logs" class="logs-list">
                            <!-- Logs injected here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- HERITAGE VIEW -->
            <section id="tab-heritage" class="tab-content">
                <div class="heritage-explorer">
                    <div class="preset-selector">
                        <h3>Heritage Presets</h3>
                        <div id="heritage-list" class="preset-btns"></div>
                    </div>
                    <div id="heritage-details" class="heritage-info">
                        <h3>Ancient Context</h3>
                        <div id="heritage-desc" class="desc-text">Select a preset to explore its historical context.
                        </div>
                    </div>
                </div>
            </section>

            <!-- CONFIG VIEW -->
            <section id="tab-config" class="tab-content">
                <div class="engine-config">
                    <div class="config-card">
                        <h3>Global Parameters</h3>
                        <div class="input-row">
                            <label>Dice Count (N):</label>
                            <input type="number" id="dice-count-input" value="6" min="1" max="20">
                        </div>
                        <div class="dice-weights-config">
                            <label>Face Probabilities:</label>
                            <div id="weight-inputs" class="weight-grid"></div>
                        </div>
                        <div id="prob-sum-display" class="sum-check">Total: 1.00</div>
                        <button id="btn-apply-config" class="btn-primary">Sync Engine</button>
                    </div>

                    <div class="config-card">
                        <h3>Parameter Solver</h3>
                        <div class="solver-ui">
                            <select id="solver-mode">
                                <option value="winrate">Solve for Win Rate</option>
                                <option value="edge">Solve for House Edge</option>
                            </select>
                            <div id="solver-target-area"></div>
                            <button id="btn-solve" class="btn-gold">Run Optimization</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="app-footer">
            <div id="log-status">Ready.</div>
            <button id="btn-export" class="btn-text">Export Session Data</button>
        </footer>
    </div>

    <!-- Core Scripts -->
    <script src="logic/rules.js"></script>
    <script src="logic/heritage.js"></script>
    <script src="engine.js"></script>
    <script src="script.js"></script>
</body>

</html>